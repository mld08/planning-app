{% extends "base.html" %}

{% block title %}Planning Semaine {{ planning.semaine }}{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- En-tête avec actions -->
    <div class="bg-gradient-to-r from-purple-600 to-purple-800 rounded-lg shadow-xl p-8 text-white">
        <div class="flex justify-between items-start">
            <div>
                <div class="flex items-center mb-2">
                    <a href="{{ url_for('liste_plannings') }}" class="text-white hover:text-purple-200 mr-4">
                        <i class="fas fa-arrow-left"></i>
                    </a>
                    <h1 class="text-3xl font-bold">
                        <i class="fas fa-calendar-week mr-2"></i>Planning Semaine {{ planning.semaine }}/{{ planning.annee }}
                    </h1>
                </div>
                <p class="text-purple-100">{{ planning.periode }}</p>
                <p class="text-sm text-purple-200 mt-2">
                    <i class="fas fa-clock mr-1"></i>Créé le {{ planning.cree_le.strftime('%d/%m/%Y à %H:%M') }}
                </p>
            </div>
            <div class="flex space-x-2">
                {% if planning.statut == 'actif' %}
                <span class="px-4 py-2 bg-green-500 rounded-full text-sm font-semibold">
                    <i class="fas fa-check-circle mr-1"></i>Actif
                </span>
                {% else %}
                <span class="px-4 py-2 bg-gray-500 rounded-full text-sm font-semibold">
                    <i class="fas fa-archive mr-1"></i>Archivé
                </span>
                {% endif %}
            </div>
        </div>
        
        <!-- Actions d'export -->
        <div class="mt-4 flex space-x-3">
            <a href="{{ url_for('export_planning_pdf', planning_id=planning.id) }}" 
               class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition">
                <i class="fas fa-file-pdf mr-2"></i>Exporter en PDF
            </a>
            <a href="{{ url_for('export_planning_excel', planning_id=planning.id) }}" 
               class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition">
                <i class="fas fa-file-excel mr-2"></i>Exporter en Excel
            </a>
        </div>
    </div>
    
    <!-- Planning par activités -->
    <div class="bg-white rounded-lg shadow-lg overflow-hidden">
        <div class="p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-6">
                <i class="fas fa-table text-purple-600 mr-2"></i>Vue d'ensemble de la semaine
            </h2>
            
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Activité / Jour
                            </th>
                            {% for jour in jours_semaine %}
                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                {{ jour }}<br>
                                <span class="text-gray-400 normal-case">{{ affectations_par_jour[jour]['date'].strftime('%d/%m') }}</span>
                            </th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        
                        <!-- I - VEILLE CRSS -->
                        <tr class="bg-yellow-50">
                            <td class="px-4 py-3 font-semibold text-gray-900 bg-yellow-100" colspan="8">
                                <i class="fas fa-eye text-yellow-600 mr-2"></i>I - VEILLE CRSS
                            </td>
                        </tr>
                        
                        <!-- CRSS Journée -->
                        <tr class="hover:bg-yellow-50 transition">
                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-700 bg-yellow-50">
                                <i class="fas fa-sun text-yellow-600 mr-2"></i>Journée: 08h - 17h
                            </td>
                            {% for jour in jours_semaine %}
                            <td class="px-4 py-3 text-center">
                                {% for aff in affectations_par_jour[jour]['affectations'] %}
                                    {% if aff.activite == 'VEILLE_CRSS' and aff.shift == 'jour' %}
                                    <div class="bg-yellow-100 border border-yellow-300 rounded p-2">
                                        <p class="text-sm font-semibold text-gray-900">{{ aff.agent.nom_complet }}</p>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                                {% if not affectations_par_jour[jour]['affectations']|selectattr('activite', 'equalto', 'VEILLE_CRSS')|selectattr('shift', 'equalto', 'jour')|list %}
                                <span class="text-gray-400 text-sm">-</span>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                        
                        <!-- CRSS Nuit -->
                        <tr class="hover:bg-indigo-50 transition">
                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-700 bg-indigo-50">
                                <i class="fas fa-moon text-indigo-600 mr-2"></i>Nuit : 17h - 08h
                            </td>
                            {% for jour in jours_semaine %}
                            <td class="px-4 py-3 text-center">
                                {% for aff in affectations_par_jour[jour]['affectations'] %}
                                    {% if aff.activite == 'VEILLE_CRSS' and aff.shift == 'nuit' %}
                                    <div class="bg-indigo-100 border border-indigo-300 rounded p-2">
                                        <p class="text-sm font-semibold text-gray-900">{{ aff.agent.nom_complet }}</p>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                                {% if not affectations_par_jour[jour]['affectations']|selectattr('activite', 'equalto', 'VEILLE_CRSS')|selectattr('shift', 'equalto', 'nuit')|list %}
                                <span class="text-gray-400 text-sm">-</span>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                        
                        <!-- II - BRIGADE BVP -->
                        <tr class="bg-orange-50">
                            <td class="px-4 py-3 font-semibold text-gray-900 bg-orange-100" colspan="8">
                                <i class="fas fa-ship text-orange-600 mr-2"></i>II - BRIGADE DE VEILLE PORTUAIRE
                            </td>
                        </tr>
                        
                        <!-- BVP - Chef d'équipe -->
                        <tr class="hover:bg-blue-50 transition">
                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-700 bg-blue-50">
                                <i class="fas fa-user-tie text-blue-600 mr-2"></i>Chef d'équipe
                            </td>
                            {% for jour in jours_semaine %}
                            <td class="px-4 py-3 text-center">
                                {% set has_chef = false %}
                                {% for aff in affectations_par_jour[jour]['affectations'] %}
                                    {% if aff.activite == 'BVP' and aff.sous_activite and 'Chef' in aff.sous_activite %}
                                    <div class="bg-blue-100 border border-blue-300 rounded p-2">
                                        <p class="text-sm font-semibold text-gray-900">{{ aff.agent.nom_complet }}</p>
                                    </div>
                                    {% set has_chef = true %}
                                    {% endif %}
                                {% endfor %}
                                {% if not has_chef %}
                                <span class="text-gray-400 text-sm">-</span>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                        
                        <!-- BVP - Inspecteur de Veille -->
                        <tr class="hover:bg-green-50 transition">
                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-700 bg-green-50">
                                <i class="fas fa-clipboard-check text-green-600 mr-2"></i>Inspecteur de Veille
                            </td>
                            {% for jour in jours_semaine %}
                            <td class="px-4 py-3 text-center">
                                {% set has_insp = false %}
                                {% for aff in affectations_par_jour[jour]['affectations'] %}
                                    {% if aff.activite == 'BVP' and aff.sous_activite and 'Inspecteur' in aff.sous_activite %}
                                    <div class="bg-green-100 border border-green-300 rounded p-2">
                                        <p class="text-sm font-semibold text-gray-900">{{ aff.agent.nom_complet }}</p>
                                    </div>
                                    {% set has_insp = true %}
                                    {% endif %}
                                {% endfor %}
                                {% if not has_insp %}
                                <span class="text-gray-400 text-sm">-</span>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                        
                        <!-- BVP - Autres agents -->
                        <tr class="hover:bg-purple-50 transition">
                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-700 bg-purple-50">
                                <i class="fas fa-users text-purple-600 mr-2"></i>Autres agents
                            </td>
                            {% for jour in jours_semaine %}
                            <td class="px-4 py-3">
                                {% set has_autres = false %}
                                <div class="space-y-1">
                                {% for aff in affectations_par_jour[jour]['affectations'] %}
                                    {% if aff.activite == 'BVP' and aff.sous_activite and 'Autres' in aff.sous_activite %}
                                    <div class="bg-purple-100 border border-purple-300 rounded p-1 text-center">
                                        <p class="text-xs font-semibold text-gray-900">{{ aff.agent.nom_complet }}</p>
                                    </div>
                                    {% set has_autres = true %}
                                    {% endif %}
                                {% endfor %}
                                </div>
                                {% if not has_autres %}
                                <span class="text-gray-400 text-sm">-</span>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                        
                        <!-- Chauffeurs BVP -->
                        <tr class="hover:bg-yellow-50 transition">
                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-700 bg-yellow-50">
                                <i class="fas fa-car text-yellow-600 mr-2"></i>Chauffeurs
                            </td>
                            {% for jour in jours_semaine %}
                            <td class="px-4 py-3 text-center">
                                {% set has_chauff = false %}
                                <div class="space-y-1">
                                {% for aff in affectations_par_jour[jour]['affectations'] %}
                                    {% if aff.activite == 'CHAUFFEUR' %}
                                    <div class="bg-yellow-100 border border-yellow-300 rounded p-1">
                                        <p class="text-xs font-semibold text-gray-900">{{ aff.agent.nom_complet }}</p>
                                    </div>
                                    {% set has_chauff = true %}
                                    {% endif %}
                                {% endfor %}
                                </div>
                                {% if not has_chauff %}
                                <span class="text-gray-400 text-sm">-</span>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                        
                        <!-- III - REPOS CHAUFFEURS -->
                        <tr class="bg-green-50">
                            <td class="px-4 py-3 font-semibold text-gray-900 bg-green-100" colspan="8">
                                <i class="fas fa-bed text-green-600 mr-2"></i>III - REPOS CHAUFFEURS
                            </td>
                        </tr>
                        <tr class="hover:bg-green-50 transition">
                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-700 bg-green-50">
                                Chauffeurs
                            </td>
                            {% for jour in jours_semaine %}
                            <td class="px-4 py-3 text-center">
                                {% for aff in affectations_par_jour[jour]['affectations'] %}
                                    {% if aff.activite == 'REPOS_CHAUFFEUR' %}
                                    <div class="bg-green-100 border border-green-300 rounded p-2">
                                        <p class="text-sm font-semibold text-gray-900">{{ aff.agent.nom_complet }}</p>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                                {% if not affectations_par_jour[jour]['affectations']|selectattr('activite', 'equalto', 'REPOS_CHAUFFEUR')|list %}
                                <span class="text-gray-400 text-sm">-</span>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                        
                        <!-- IV - CERTIFICATION DIRECTION -->
                        <tr class="bg-blue-50">
                            <td class="px-4 py-3 font-semibold text-gray-900 bg-blue-100" colspan="8">
                                <i class="fas fa-certificate text-blue-600 mr-2"></i>IV - CERTIFICATION CAPTURE - DIRECTION
                            </td>
                        </tr>
                        <tr class="hover:bg-blue-50 transition">
                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-700 bg-blue-50">
                                Agents
                            </td>
                            {% for jour in jours_semaine %}
                            <td class="px-4 py-3">
                                {% set has_cert = false %}
                                <div class="space-y-1">
                                {% for aff in affectations_par_jour[jour]['affectations'] %}
                                    {% if aff.activite == 'CERTIFICATION_DIRECTION' %}
                                    <div class="bg-blue-100 border border-blue-300 rounded p-1">
                                        <p class="text-xs font-semibold text-gray-900">{{ aff.agent.nom_complet }}</p>
                                    </div>
                                    {% set has_cert = true %}
                                    {% endif %}
                                {% endfor %}
                                </div>
                                {% if not has_cert %}
                                <span class="text-gray-400 text-sm">-</span>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                        
                        <!-- V - CERTIFICATION AEROPORT -->
                        <tr class="bg-teal-50">
                            <td class="px-4 py-3 font-semibold text-gray-900 bg-teal-100" colspan="8">
                                <i class="fas fa-plane text-teal-600 mr-2"></i>V - CERTIFICATION CAPTURE - AEROPORT
                            </td>
                        </tr>
                        <tr class="hover:bg-teal-50 transition">
                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-700 bg-teal-50">
                                Agents
                            </td>
                            {% for jour in jours_semaine %}
                            <td class="px-4 py-3 text-center">
                                {% for aff in affectations_par_jour[jour]['affectations'] %}
                                    {% if aff.activite == 'CERTIFICATION_AEROPORT' %}
                                    <div class="bg-teal-100 border border-teal-300 rounded p-2">
                                        <p class="text-sm font-semibold text-gray-900">{{ aff.agent.nom_complet }}</p>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                                {% if not affectations_par_jour[jour]['affectations']|selectattr('activite', 'equalto', 'CERTIFICATION_AEROPORT')|list %}
                                <span class="text-gray-400 text-sm">-</span>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                        
                        <!-- VI - PATROUILLE MARITIME COTIERE -->
                        <tr class="bg-indigo-50">
                            <td class="px-4 py-3 font-semibold text-gray-900 bg-indigo-100" colspan="8">
                                <i class="fas fa-anchor text-indigo-600 mr-2"></i>VI - PATROUILLE MARITIME COTIERE
                            </td>
                        </tr>
                        <tr class="hover:bg-indigo-50 transition">
                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-700 bg-indigo-50">
                                Inspecteurs
                            </td>
                            {% for jour in jours_semaine %}
                            <td class="px-4 py-3 text-center">
                                {% for aff in affectations_par_jour[jour]['affectations'] %}
                                    {% if aff.activite == 'PATROUILLE_COTIERE' %}
                                    <div class="bg-indigo-100 border border-indigo-300 rounded p-2">
                                        <p class="text-sm font-semibold text-gray-900">{{ aff.agent.nom_complet }}</p>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                                {% if not affectations_par_jour[jour]['affectations']|selectattr('activite', 'equalto', 'PATROUILLE_COTIERE')|list %}
                                <span class="text-gray-400 text-sm">-</span>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                        
                        <!-- VII - GARDIENNAGE -->
                        <tr class="bg-purple-50">
                            <td class="px-4 py-3 font-semibold text-gray-900 bg-purple-100" colspan="8">
                                <i class="fas fa-shield-alt text-purple-600 mr-2"></i>VII - GARDIENNAGE
                            </td>
                        </tr>
                        <tr class="hover:bg-purple-50 transition">
                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-700 bg-purple-50">
                                Agents
                            </td>
                            {% for jour in jours_semaine %}
                            <td class="px-4 py-3 text-center">
                                {% for aff in affectations_par_jour[jour]['affectations'] %}
                                    {% if aff.activite == 'GARDIENNAGE' %}
                                    <div class="bg-purple-100 border border-purple-300 rounded p-2">
                                        <p class="text-sm font-semibold text-gray-900">{{ aff.agent.nom_complet }}</p>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                                {% if not affectations_par_jour[jour]['affectations']|selectattr('activite', 'equalto', 'GARDIENNAGE')|list %}
                                <span class="text-gray-400 text-sm">-</span>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                        
                        <!-- VIII - COURRIER -->
                        <tr class="bg-pink-50">
                            <td class="px-4 py-3 font-semibold text-gray-900 bg-pink-100" colspan="8">
                                <i class="fas fa-envelope text-pink-600 mr-2"></i>VIII - COURRIER
                            </td>
                        </tr>
                        <tr class="hover:bg-pink-50 transition">
                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-700 bg-pink-50">
                                Chauffeurs
                            </td>
                            {% for jour in jours_semaine %}
                            <td class="px-4 py-3 text-center">
                                {% for aff in affectations_par_jour[jour]['affectations'] %}
                                    {% if aff.activite == 'COURRIER' %}
                                    <div class="bg-pink-100 border border-pink-300 rounded p-2">
                                        <p class="text-sm font-semibold text-gray-900">{{ aff.agent.nom_complet }}</p>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                                {% if not affectations_par_jour[jour]['affectations']|selectattr('activite', 'equalto', 'COURRIER')|list %}
                                <span class="text-gray-400 text-sm">-</span>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                        
                        <!-- IX - INSPECTION USINES -->
                        <tr class="bg-green-50">
                            <td class="px-4 py-3 font-semibold text-gray-900 bg-green-100" colspan="8">
                                <i class="fas fa-industry text-green-600 mr-2"></i>IX - INSPECTION USINES
                            </td>
                        </tr>
                        <tr class="hover:bg-green-50 transition">
                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-700 bg-green-50">
                                Inspecteurs
                            </td>
                            {% for jour in jours_semaine %}
                            <td class="px-4 py-3">
                                {% set has_insp_usine = false %}
                                <div class="space-y-1">
                                {% for aff in affectations_par_jour[jour]['affectations'] %}
                                    {% if aff.activite == 'INSPECTION_USINE' and aff.sous_activite and 'Inspecteur' in aff.sous_activite %}
                                    <div class="bg-green-100 border border-green-300 rounded p-1">
                                        <p class="text-xs font-semibold text-gray-900">{{ aff.agent.nom_complet }}</p>
                                    </div>
                                    {% set has_insp_usine = true %}
                                    {% endif %}
                                {% endfor %}
                                </div>
                                {% if not has_insp_usine %}
                                <span class="text-gray-400 text-sm">-</span>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                        <tr class="hover:bg-yellow-50 transition">
                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-700 bg-yellow-50">
                                <i class="fas fa-car text-yellow-600 mr-2"></i>Chauffeurs
                            </td>
                            {% for jour in jours_semaine %}
                            <td class="px-4 py-3 text-center">
                                {% set has_chauff_usine = false %}
                                {% for aff in affectations_par_jour[jour]['affectations'] %}
                                    {% if aff.activite == 'INSPECTION_USINE' and aff.sous_activite and 'Chauffeur' in aff.sous_activite %}
                                    <div class="bg-yellow-100 border border-yellow-300 rounded p-2">
                                        <p class="text-sm font-semibold text-gray-900">{{ aff.agent.nom_complet }}</p>
                                    </div>
                                    {% set has_chauff_usine = true %}
                                    {% endif %}
                                {% endfor %}
                                {% if not has_chauff_usine %}
                                <span class="text-gray-400 text-sm">-</span>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                        
                        <!-- X - PATROUILLE AERIENNE -->
                        <tr class="bg-blue-50">
                            <td class="px-4 py-3 font-semibold text-gray-900 bg-blue-100" colspan="8">
                                <i class="fas fa-helicopter text-blue-600 mr-2"></i>X - PATROUILLE AERIENNE
                            </td>
                        </tr>
                        <tr class="hover:bg-blue-50 transition">
                            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-700 bg-blue-50">
                                Inspecteurs
                            </td>
                            {% for jour in jours_semaine %}
                            <td class="px-4 py-3 text-center">
                                {% for aff in affectations_par_jour[jour]['affectations'] %}
                                    {% if aff.activite == 'PATROUILLE_AERIENNE' %}
                                    <div class="bg-blue-100 border border-blue-300 rounded p-2">
                                        <p class="text-sm font-semibold text-gray-900">{{ aff.agent.nom_complet }}</p>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                                {% if not affectations_par_jour[jour]['affectations']|selectattr('activite', 'equalto', 'PATROUILLE_AERIENNE')|list %}
                                <span class="text-gray-400 text-sm">-</span>
                                {% endif %}
                            </td>
                            {% endfor %}
                        </tr>
                        
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Statistiques -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0 bg-blue-500 rounded-md p-3">
                    <i class="fas fa-users text-white text-2xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Agents mobilisés</p>
                    <p class="text-2xl font-semibold text-gray-900">
                        {% set all_agents = [] %}
                        {% for jour in jours_semaine %}
                            {% for aff in affectations_par_jour[jour]['affectations'] %}
                                {% if aff.agent_id not in all_agents %}
                                    {% set _ = all_agents.append(aff.agent_id) %}
                                {% endif %}
                            {% endfor %}
                        {% endfor %}
                        {{ all_agents|length }}
                    </p>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0 bg-green-500 rounded-md p-3">
                    <i class="fas fa-tasks text-white text-2xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Types d'activités</p>
                    <p class="text-2xl font-semibold text-gray-900">
                        {% set all_activites = [] %}
                        {% for jour in jours_semaine %}
                            {% for aff in affectations_par_jour[jour]['affectations'] %}
                                {% if aff.activite and aff.activite not in all_activites %}
                                    {% set _ = all_activites.append(aff.activite) %}
                                {% endif %}
                            {% endfor %}
                        {% endfor %}
                        {{ all_activites|length }}
                    </p>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0 bg-purple-500 rounded-md p-3">
                    <i class="fas fa-calendar-check text-white text-2xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Total affectations</p>
                    <p class="text-2xl font-semibold text-gray-900">
                        {% set total = 0 %}
                        {% for jour in jours_semaine %}
                            {% set total = total + affectations_par_jour[jour]['affectations']|length %}
                        {% endfor %}
                        {{ total }}
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Légende -->
    <div class="bg-white rounded-lg shadow-lg p-6">
        <h3 class="text-lg font-bold text-gray-800 mb-4">
            <i class="fas fa-info-circle text-blue-600 mr-2"></i>Légende des activités
        </h3>
        <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
            <div class="flex items-center space-x-2">
                <div class="w-4 h-4 bg-yellow-100 border border-yellow-300 rounded"></div>
                <span class="text-xs text-gray-700">Veille CRSS</span>
            </div>
            <div class="flex items-center space-x-2">
                <div class="w-4 h-4 bg-orange-100 border border-orange-300 rounded"></div>
                <span class="text-xs text-gray-700">BVP</span>
            </div>
            <div class="flex items-center space-x-2">
                <div class="w-4 h-4 bg-blue-100 border border-blue-300 rounded"></div>
                <span class="text-xs text-gray-700">Certification</span>
            </div>
            <div class="flex items-center space-x-2">
                <div class="w-4 h-4 bg-green-100 border border-green-300 rounded"></div>
                <span class="text-xs text-gray-700">Inspection</span>
            </div>
            <div class="flex items-center space-x-2">
                <div class="w-4 h-4 bg-purple-100 border border-purple-300 rounded"></div>
                <span class="text-xs text-gray-700">Gardiennage</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}